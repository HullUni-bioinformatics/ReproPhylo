
<tool id="make_DB_and_Read_genbank" name="make DB and Read genbank" version="0.1" hidden="false">
    <description>Read a genbank and a fasta file, read or write a loci CSV file
    </description>
    <command interpreter="python">
        base_reprophylo.py 
        #if $getproj.newproj=="no"
        $getproj.projfile -_ -a $altprojfile 
        #else if $getproj.newproj=="yes"
        $projfileout -_ 
        #end if
        #if $islocicsvin.read_loci_csv=="yes" 
        -r $islocicsvin.loci_csv_in 
        #else if $islocicsvin.read_loci_csv=="fromcline"
        -u $islocicsvin.char_type $islocicsvin.feature_type $name 
        #else if $islocicsvin.read_loci_csv=="write"
        -w $loci_csv_out 
        #end if 
        #if $islocicsvin.read_loci_csv=="yes" and $islocicsvin.banish_loci=='yes'
        -b 
        #else if $islocicsvin.read_loci_csv=="fromcline" and $islocicsvin.banish_locii=='yes'
        -b 
        #end if
        #if $isgenbank.read_genbank_file=="yes"
        -g $isgenbank.genbank 
        #end if
        #if $isfasta.read_fasta_file=="yesCline"
        -f $isfasta.fasta -t $isfasta.fasta_chartype -n $isfasta.genename $isfasta.featuretype -q $isfasta.qualis_fasname -i $isfasta.qualis_seqid -d $isfasta.qualis_seqdesc
        #end if

    </command>
    <inputs>
        <conditional name="getproj">
           <param name="newproj" type="select" label="Is this a new Project?">
                <option value="no">No</option>
                <option value="yes">Yes</option>
           </param>
           <when value="no">
                <param name="projfile" type="data" label="Project file"/>
           </when>
           <when value="yes"/>
        </conditional>
        <conditional name="isgenbank">
           <param name="read_genbank_file" type="select" label="Read a genbank or embl file?">
                <option value="no">No</option>
                <option value="yes">Yes</option> 
           </param>
           <when value="no"/>
           <when value="yes">
                <param name="genbank" type="data" label="genbank or embl file"/>
           </when>
        </conditional>
        <conditional name="islocicsvin">
           <param name="read_loci_csv" type="select" label="Read or write loci (required if no genbank)?">
                <option value="no">No (either because some loci exist in the Project or you read a genbank file)</option>
                <option value="yes">From a CSV file</option> 
                <option value="fromcline">Feed one manually</option>  
                <option value="write">Project contains loci, write a CSV</option> 
           </param>
           <when value="no"/>
           <when value="yes">
                <param name="loci_csv_in" type="data" label="Input loci CSV file"/>
                <param name="banish_loci" type="select" label="Delete preexisting loci?">
                    <option value="no">No, just add new ones</option>
                    <option value="yes">Yes, overwrite them with the new ones</option>
                </param>
           </when>
           <when value="fromcline">
                <param name="char_type" type="select" label="The locus will be handled as:">
                    <option value="dna">DNA</option>
                    <option value="prot">Protein</option>
                </param> 
                <param name="feature_type" type="text" label="CDS, rRNA, Protein, gene, tRNA ..."/>
                <param name="gene_name" type="text" label="The name of the gene (if you want to customize aliases, better read a CSV)"/>
                <param name="banish_locii" type="select" label="Delete preexisting loci?">
                    <option value="no">No, just add new ones</option>
                    <option value="yes">Yes, overwrite them with the new ones</option>
                </param>
           </when>
           <when value="write"/>
        </conditional>
        <conditional name="isfasta">
           <param name="read_fasta_file" type="select" label="Read a fasta file?">
                <option value="no">No</option>
                <option value="yesCline">Yes</option> 
           </param>
           <when value="no"/>
           <when value="yesCline">
                <param name="fasta" type="data" label="fasta file"/>
                <param name="fasta_chartype" type="select" label="DNA or Protein fasta?">
                    <option value="dna">DNA</option>
                    <option value="prot">Prot</option>
                </param>
                <param name="genename" type="text" value="undeterminedGene" label="The gene name of the fasta sequences"/>
                <param name="featuretype" type="text" value="undeterminedFeature"  label="The feature type of the fasta sequences"/>
                <param name="qualis_fasname" type="text" value="fileName" label="The filename is"/>
                <param name="qualis_seqid" type="text" value="seqid"  label="The seqid is"/>
                <param name="qualis_seqdesc" type="text" value="seqdesc" label="The seqdesc is"/>
           </when>
        </conditional>
    </inputs>
    <outputs>
        <data name="projfileout" label="${tool.name} on ${on_string}: ReproPhylo Project" >
            <filter>getproj['newproj'] == "yes"</filter>
        </data >
        <data name="altprojfile" label="${tool.name} on ${on_string}: ReproPhylo Project" >
            <filter>getproj['newproj'] == "no"</filter>
        </data >
        <data name="loci_csv_out" label="${tool.name} on ${on_string}: Loci CSV output" >
            <filter>islocicsvin['read_loci_csv'] == "write"</filter>
        </data >
    </outputs>
</tool>